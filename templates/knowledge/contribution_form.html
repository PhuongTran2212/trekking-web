{% extends "base.html" %}
{% load static %}

{% block title %}ƒê√≥ng g√≥p Ki·∫øn Th·ª©c - TrekViet{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<!-- THAY ƒê·ªîI ·ªû ƒê√ÇY: S·ª≠ d·ª•ng cdnjs thay v√¨ tiny.cloud ƒë·ªÉ kh√¥ng c·∫ßn API Key -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.3/tinymce.min.js" referrerpolicy="origin"></script>

<style>
    /* === 1. BI·∫æN M√ÄU T·ª™ STYLES.CSS (Gi·ªØ nguy√™n) === */
    :root {
        --primary-lightest: #F4FFFC;
        --primary-light: #91EAAF;
        --primary-medium: #C3E956;
        --primary-dark: #4D7111;
        --primary-darkest: #1F4B2C;
        
        --gray-50: #FAFAFA;
        --gray-100: #F4F4F5;
        --gray-200: #E4E4E7;
        --gray-300: #D4D4D8;
        --gray-400: #A1A1AA;
        --gray-500: #71717A;
        --gray-600: #52525B;
        --gray-700: #3F3F46;
        --gray-800: #27272A;
        --gray-900: #18181B;
        
        --success: #22C55E;
        --warning: #EAB308;
        --danger: #EF4444;
        
        --spacing-xs: 0.25rem;
        --spacing-sm: 0.5rem;
        --spacing-md: 1rem;
        --spacing-lg: 1.5rem;
        --spacing-xl: 2rem;
        --spacing-2xl: 3rem;
        
        --radius-sm: 0.25rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --radius-full: 9999px;
        
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
    }

    body {
        background: linear-gradient(135deg, var(--gray-50) 0%, var(--primary-lightest) 100%);
        color: var(--gray-800);
        min-height: 100vh;
    }

    /* === 2. CONTAINER === */
    .center-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 var(--spacing-xl);
    }

    /* === 3. ANIMATED HEADER === */
    .page-header {
        text-align: center;
        padding: var(--spacing-2xl) 0;
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, var(--primary-light) 0%, transparent 70%);
        opacity: 0.1;
        animation: float 20s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translate(0, 0) rotate(0deg); }
        33% { transform: translate(30px, -30px) rotate(120deg); }
        66% { transform: translate(-20px, 20px) rotate(240deg); }
    }

    .page-header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--gray-900);
        margin-bottom: var(--spacing-md);
        letter-spacing: -0.5px;
        position: relative;
        display: inline-block;
        animation: slideInDown 0.6s ease-out;
    }

    @keyframes slideInDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .page-header h1::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 60%;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-light), var(--primary-medium));
        border-radius: var(--radius-full);
        animation: expandWidth 0.8s ease-out 0.3s both;
    }

    @keyframes expandWidth {
        from { width: 0; }
        to { width: 60%; }
    }

    .page-header p {
        color: var(--gray-600);
        font-size: 1.125rem;
        max-width: 600px;
        margin: 0 auto;
        position: relative;
        animation: fadeIn 0.8s ease-out 0.4s both;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* === 4. CARDS V·ªöI HI·ªÜU ·ª®NG === */
    .clean-card {
        background: white;
        border-radius: var(--radius-xl);
        border: 1px solid var(--gray-200);
        box-shadow: var(--shadow-md);
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        animation: fadeInUp 0.6s ease-out both;
    }

    .clean-card:hover {
        box-shadow: var(--shadow-xl);
        transform: translateY(-4px);
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .col-lg-8 .clean-card {
        animation-delay: 0.1s;
    }

    .col-lg-4 > *:nth-child(1) {
        animation: fadeInUp 0.6s ease-out 0.2s both;
    }

    .col-lg-4 > *:nth-child(2) {
        animation: fadeInUp 0.6s ease-out 0.3s both;
    }

    .clean-card-header {
        background: linear-gradient(135deg, var(--primary-lightest) 0%, white 100%);
        padding: var(--spacing-lg);
        border-bottom: 2px solid var(--primary-light);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        position: relative;
        overflow: hidden;
    }

    .clean-card-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(195, 233, 86, 0.2), transparent);
        transition: left 0.5s ease;
    }

    .clean-card:hover .clean-card-header::before {
        left: 100%;
    }

    .clean-card-header i {
        color: var(--primary-dark);
        font-size: 1.5rem;
        animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }

    .clean-card-header h3 {
        font-size: 1.25rem;
        font-weight: 700;
        margin: 0;
        color: var(--gray-900);
    }

    .clean-card-body {
        padding: var(--spacing-xl);
    }

    /* === 5. FORM INPUTS V·ªöI HI·ªÜU ·ª®NG === */
    .form-group {
        margin-bottom: var(--spacing-xl);
        position: relative;
    }

    .form-label {
        display: inline-block;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: var(--spacing-md);
        font-size: 1rem;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-medium) 100%);
        padding: 0.5rem 1rem;
        border-radius: var(--radius-md);
        border-left: 4px solid var(--primary-dark);
        box-shadow: var(--shadow-sm);
    }

    .form-control {
        width: 100%;
        padding: 0.875rem 1.125rem;
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-lg);
        font-size: 0.95rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background-color: var(--gray-50);
        position: relative;
    }

    .form-control:focus {
        border-color: var(--primary-medium);
        box-shadow: 0 0 0 4px rgba(195, 233, 86, 0.1);
        outline: none;
        background-color: white;
        transform: translateY(-2px);
    }

    .form-control:focus + .form-label {
        transform: scale(1.02);
        box-shadow: var(--shadow-md);
    }

    .form-help-text {
        font-size: 0.85rem;
        color: var(--gray-500);
        margin-top: var(--spacing-sm);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        opacity: 0;
        animation: fadeIn 0.3s ease-out 0.2s both;
    }

    /* === 6. BUTTONS V·ªöI HI·ªÜU ·ª®NG === */
    .btn-action {
        background: linear-gradient(135deg, var(--primary-medium) 0%, var(--primary-dark) 100%);
        color: var(--primary-darkest);
        padding: 0.875rem 2rem;
        border-radius: var(--radius-lg);
        font-weight: 700;
        border: none;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-sm);
        position: relative;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 15px rgba(77, 113, 17, 0.2);
    }

    .btn-action::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s ease, height 0.6s ease;
    }

    .btn-action:hover::before {
        width: 300px;
        height: 300px;
    }

    .btn-action:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(77, 113, 17, 0.3);
    }

    .btn-action:active {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(77, 113, 17, 0.2);
    }

    .btn-action i {
        position: relative;
        z-index: 1;
        transition: transform 0.3s ease;
    }

    .btn-action:hover i {
        transform: translateX(5px);
    }

    .btn-cancel {
        background: transparent;
        color: var(--gray-600);
        padding: 0.875rem 1.75rem;
        border: 2px solid var(--gray-300);
        border-radius: var(--radius-lg);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .btn-cancel::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: var(--gray-100);
        transition: left 0.3s ease;
        z-index: 0;
    }

    .btn-cancel:hover::before {
        left: 0;
    }

    .btn-cancel:hover {
        color: var(--gray-900);
        border-color: var(--gray-400);
        transform: translateY(-2px);
    }

    /* === 7. TIPS BOX V·ªöI GRADIENT === */
    .tips-box {
        background: linear-gradient(135deg, var(--primary-lightest) 0%, #E8F9EF 100%);
        border: 2px solid var(--primary-light);
        border-radius: var(--radius-xl);
        padding: var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
        position: relative;
        overflow: hidden;
    }

    .tips-box::before {
        content: 'üí°';
        position: absolute;
        top: -20px;
        right: -20px;
        font-size: 120px;
        opacity: 0.05;
        transform: rotate(-15deg);
    }

    .tips-title {
        color: var(--primary-darkest);
        font-weight: 700;
        margin-bottom: var(--spacing-lg);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        font-size: 1.125rem;
    }

    .tips-title i {
        color: var(--warning);
        animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.8; }
    }

    .tips-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .tips-list li {
        display: flex;
        align-items: start;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-md);
        font-size: 0.95rem;
        color: var(--gray-800);
        padding: var(--spacing-sm);
        border-radius: var(--radius-md);
        transition: all 0.3s ease;
        animation: fadeInLeft 0.5s ease-out both;
    }

    .tips-list li:nth-child(1) { animation-delay: 0.1s; }
    .tips-list li:nth-child(2) { animation-delay: 0.2s; }
    .tips-list li:nth-child(3) { animation-delay: 0.3s; }
    .tips-list li:nth-child(4) { animation-delay: 0.4s; }

    @keyframes fadeInLeft {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .tips-list li:hover {
        background: rgba(255, 255, 255, 0.5);
        transform: translateX(5px);
    }

    .tips-list i {
        color: var(--success);
        margin-top: 3px;
        font-size: 1.125rem;
        flex-shrink: 0;
    }

    /* === 8. TIMELINE V·ªöI ANIMATION === */
    .timeline-simple {
        padding-left: var(--spacing-lg);
        border-left: 3px solid var(--gray-200);
        margin-left: var(--spacing-sm);
        position: relative;
    }

    .timeline-simple::before {
        content: '';
        position: absolute;
        left: -3px;
        top: 0;
        width: 3px;
        height: 0;
        background: linear-gradient(180deg, var(--primary-medium), var(--primary-dark));
        animation: progressLine 2s ease-out forwards;
    }

    @keyframes progressLine {
        to { height: 100%; }
    }

    .timeline-item {
        position: relative;
        padding-left: var(--spacing-xl);
        padding-bottom: var(--spacing-xl);
        animation: fadeInRight 0.5s ease-out both;
    }

    .timeline-item:nth-child(1) { animation-delay: 0.2s; }
    .timeline-item:nth-child(2) { animation-delay: 0.4s; }
    .timeline-item:nth-child(3) { animation-delay: 0.6s; }

    @keyframes fadeInRight {
        from {
            opacity: 0;
            transform: translateX(20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .timeline-item::before {
        content: '';
        position: absolute;
        left: -11px;
        top: 0;
        width: 20px;
        height: 20px;
        border-radius: var(--radius-full);
        background: white;
        border: 4px solid var(--primary-medium);
        transition: all 0.3s ease;
        animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) both;
    }

    @keyframes scaleIn {
        from {
            transform: scale(0);
        }
        to {
            transform: scale(1);
        }
    }

    .timeline-item:hover::before {
        background: var(--primary-medium);
        transform: scale(1.3);
        box-shadow: 0 0 0 4px rgba(195, 233, 86, 0.2);
    }

    .timeline-item h4 {
        font-size: 1rem;
        font-weight: 700;
        margin: 0 0 var(--spacing-xs) 0;
        color: var(--gray-900);
    }

    .timeline-item p {
        font-size: 0.875rem;
        color: var(--gray-600);
        margin: 0;
    }

    .timeline-item:last-child {
        padding-bottom: 0;
    }

    /* === 9. ALERTS V·ªöI SLIDE IN === */
    .alert {
        border-radius: var(--radius-lg);
        padding: var(--spacing-lg);
        margin-bottom: var(--spacing-lg);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        box-shadow: var(--shadow-md);
        animation: slideInDown 0.5s ease-out;
        border-left: 4px solid;
    }

    .alert-success {
        background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
        border-left-color: var(--success);
    }

    .alert-info {
        background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
        border-left-color: #3B82F6;
    }

    /* === 10. RESPONSIVE === */
    @media (max-width: 768px) {
        .page-header h1 {
            font-size: 2rem;
        }
        
        .clean-card-body {
            padding: var(--spacing-lg);
        }
        
        .btn-action,
        .btn-cancel {
            width: 100%;
            justify-content: center;
        }
    }

    /* === 11. LOADING STATE === */
    @keyframes shimmer {
        0% {
            background-position: -1000px 0;
        }
        100% {
            background-position: 1000px 0;
        }
    }

    .form-control:disabled {
        background: linear-gradient(90deg, var(--gray-100) 25%, var(--gray-200) 50%, var(--gray-100) 75%);
        background-size: 1000px 100%;
        animation: shimmer 2s infinite;
    }
</style>
{% endblock %}

{% block content %}
<div class="center-container">
    
    <div class="page-header">
        <h1>Chia S·∫ª Ki·∫øn Th·ª©c</h1>
        <p>ƒê√≥ng g√≥p kinh nghi·ªám th·ª±c t·∫ø c·ªßa b·∫°n ƒë·ªÉ c·ªông ƒë·ªìng Trekking Vi·ªát Nam c√πng ph√°t tri·ªÉn.</p>
    </div>

    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags|default:'info' }}">
            <i class="fa-solid fa-circle-info"></i>
            <span>{{ message }}</span>
        </div>
        {% endfor %}
    {% endif %}

    <div class="row g-4" style="justify-content: center;">
        <div class="col-lg-9 col-xl-8">
            <div class="clean-card">
                <div class="clean-card-header">
                    <i class="fa-regular fa-pen-to-square"></i>
                    <h3>N·ªôi dung b√†i vi·∫øt</h3>
                </div>
                
                <div class="clean-card-body">
                    <form method="post" novalidate>
                        {% csrf_token %}

                        {% for field in form %}
                            <div class="form-group">
                                <label for="{{ field.id_for_label }}" class="form-label">
                                    {{ field.label }} {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                                </label>
                                
                                {{ field }}

                                {% if field.help_text %}
                                    <div class="form-help-text">
                                        <i class="fa-regular fa-circle-question"></i>
                                        <span>{{ field.help_text }}</span>
                                    </div>
                                {% endif %}

                                {% if field.errors %}
                                    {% for error in field.errors %}
                                        <div class="text-danger mt-1 small">
                                            <i class="fa-solid fa-circle-exclamation me-1"></i> {{ error }}
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        {% endfor %}

                        <div class="d-flex justify-content-end gap-3 mt-4 pt-3 border-top border-light">
                            <a href="{% url 'knowledge:list' %}" class="btn-cancel">
                                <span>H·ªßy b·ªè</span>
                            </a>
                            <button type="submit" class="btn-action">
                                <span>G·ª≠i b√†i ngay</span>
                                <i class="fa-solid fa-paper-plane"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-xl-4">
            <div class="tips-box">
                <div class="tips-title">
                    <i class="fa-solid fa-lightbulb"></i>
                    <span>L∆∞u √Ω nh·ªè</span>
                </div>
                <ul class="tips-list">
                    <li>
                        <i class="fa-solid fa-check"></i>
                        <span>Ti√™u ƒë·ªÅ ng·∫Øn g·ªçn, ƒë√∫ng tr·ªçng t√¢m.</span>
                    </li>
                    <li>
                        <i class="fa-solid fa-check"></i>
                        <span>D√πng ti·∫øng Vi·ªát c√≥ d·∫•u.</span>
                    </li>
                    <li>
                        <i class="fa-solid fa-check"></i>
                        <span>Kh√¥ng copy y nguy√™n b√†i ng∆∞·ªùi kh√°c.</span>
                    </li>
                </ul>
            </div>

            <div class="clean-card">
                <div class="clean-card-header py-3">
                    <i class="fa-solid fa-list-check"></i>
                    <h3 style="font-size: 1rem;">Quy tr√¨nh duy·ªát</h3>
                </div>
                <div class="clean-card-body">
                    <div class="timeline-simple">
                        <div class="timeline-item">
                            <h4>G·ª≠i b√†i vi·∫øt</h4>
                            <p>Tr·∫°ng th√°i: "Ch·ªù duy·ªát"</p>
                        </div>
                        <div class="timeline-item">
                            <h4>Ki·ªÉm duy·ªát</h4>
                            <p>Admin xem x√©t trong 24h</p>
                        </div>
                        <div class="timeline-item">
                            <h4>C√¥ng khai</h4>
                            <p>B√†i vi·∫øt hi·ªÉn th·ªã l√™n web</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- TinyMCE Initialization -->
<script>
    tinymce.init({
        selector: 'textarea',  // √Åp d·ª•ng cho t·∫•t c·∫£ th·∫ª textarea
        height: 500,
        menubar: false, 
        plugins: [
            'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
            'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
            'insertdatetime', 'media', 'table', 'help', 'wordcount'
        ],
        toolbar: 'undo redo | formatselect | ' +
        'bold italic backcolor | alignleft aligncenter ' +
        'alignright alignjustify | bullist numlist outdent indent | ' +
        'removeformat | help',
        content_style: 'body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 14px }',
    });

    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.querySelectorAll('form input, form textarea, form select');
        inputs.forEach(input => {
            if (!input.classList.contains('form-control') && 
                input.type !== 'checkbox' && 
                input.type !== 'radio' && 
                input.type !== 'submit') {
                input.classList.add('form-control');
            }
        });

        const buttons = document.querySelectorAll('.btn-action, .btn-cancel');
        buttons.forEach(button => {
            button.addEventListener('click', function(e) {
                const ripple = document.createElement('span');
                const rect = button.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    background: rgba(255, 255, 255, 0.5);
                    border-radius: 50%;
                    transform: scale(0);
                    animation: ripple-effect 0.6s ease-out;
                    pointer-events: none;
                `;
                
                button.style.position = 'relative';
                button.style.overflow = 'hidden';
                button.appendChild(ripple);
                
                setTimeout(() => ripple.remove(), 600);
            });
        });

        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple-effect {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        const formControls = document.querySelectorAll('.form-control');
        formControls.forEach(control => {
            control.addEventListener('focus', function() {
                this.parentElement.querySelector('.form-label')?.classList.add('active');
            });
            
            control.addEventListener('blur', function() {
                if (!this.value) {
                    this.parentElement.querySelector('.form-label')?.classList.remove('active');
                }
            });
        });
    });
</script>
{% endblock %}