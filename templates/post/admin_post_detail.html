<!-- templates/post/admin_post_detail.html -->
{% extends 'admin_base.html' %}

{% block title %}{{ title }} - TrekViet Admin{% endblock title %}

{% block content %}
<style>
    .detail-container {
        display: flex;
        gap: var(--spacing-xl);
        align-items: flex-start;
    }
    .main-content-column {
        flex: 3; /* Chiếm 3/4 không gian */
    }
    .sidebar-column {
        flex: 1; /* Chiếm 1/4 không gian */
        position: sticky;
        top: calc(var(--admin-header-height) + var(--spacing-xl));
    }
    .card {
        background-color: white;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        padding: var(--spacing-lg);
        margin-bottom: var(--spacing-lg);
    }
    .post-title {
        font-family: var(--font-heading);
        font-size: 2.25rem;
        line-height: 1.2;
        color: var(--gray-800);
        margin-bottom: var(--spacing-md);
    }
    .post-meta {
        color: var(--gray-500);
        font-size: 0.875rem;
        margin-bottom: var(--spacing-lg);
    }
    .post-content {
        font-size: 1.125rem;
        line-height: 1.6;
        color: var(--gray-700);
    }
    .post-content img {
        max-width: 100%;
        height: auto;
        border-radius: var(--radius-md);
        margin: var(--spacing-lg) 0;
    }
    .section-title {
        font-family: var(--font-heading);
        font-size: 1.25rem;
        margin-bottom: var(--spacing-md);
        border-bottom: 1px solid var(--gray-200);
        padding-bottom: var(--spacing-sm);
    }
    .info-list li {
        list-style: none;
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
    }
    .info-list .label { color: var(--gray-500); }
    .info-list .value { font-weight: 600; }
    .tag-list { display: flex; flex-wrap: wrap; gap: 0.5rem; }
    .tag { background-color: var(--gray-100); color: var(--gray-700); padding: 0.25rem 0.75rem; border-radius: var(--radius-full); font-size: 0.8rem; }
    .action-buttons { display: flex; flex-direction: column; gap: 0.5rem; }
    .action-btn { width: 100%; text-align: center; display: block; background: none; border: 1px solid var(--gray-300); border-radius: var(--radius-md); padding: 0.75rem; cursor: pointer; font-size: 0.875rem; font-weight: 600; transition: all var(--transition-fast); }
    .btn-approve { color: var(--success); border-color: var(--success); }
    .btn-approve:hover { background-color: var(--success); color: white; }
    .btn-reject { color: #F59E0B; border-color: #F59E0B; }
    .btn-reject:hover { background-color: #F59E0B; color: white; }
    .btn-delete { color: var(--danger); border-color: var(--danger); }
    .btn-delete:hover { background-color: var(--danger); color: white; }
</style>

<a href="{% url 'post_admin:post_list' %}" style="margin-bottom: var(--spacing-lg); display: inline-block;">&larr; Quay lại danh sách</a>

<div class="detail-container">
    <!-- CỘT NỘI DUNG CHÍNH -->
    <div class="main-content-column">
        <div class="card">
            <h1 class="post-title">{{ post.tieu_de }}</h1>
            <div class="post-meta">
                Đăng bởi <strong>@{{ post.tac_gia.username }}</strong> vào {{ post.ngay_dang|date:"H:i, d/m/Y" }}
            </div>
            <div class="post-content">
                {{ post.noi_dung|linebreaksbr }}
            </div>

            <!-- HIỂN THỊ MEDIA -->
            {% if post.media.all %}
                <h3 class="section-title" style="margin-top: 2rem;">Media</h3>
                {% for media_item in post.media.all %}
                    <img src="{{ media_item.duong_dan_file.url }}" alt="Media cho bài viết">
                {% endfor %}
            {% endif %}
        </div>
        
        <!-- HIỂN THỊ BÌNH LUẬN -->
        <div class="card">
            <h3 class="section-title">Bình luận ({{ post.binh_luan.count }})</h3>
            {% for comment in post.binh_luan.all %}
                <div style="border-bottom: 1px solid #eee; padding: 1rem 0;">
                    <p><strong>@{{ comment.user.username }}</strong> <span style="color: #999; font-size: 0.8rem;"> - {{ comment.ngay_binh_luan|date:"H:i, d/m/Y" }}</span></p>
                    <p>{{ comment.noi_dung }}</p>
                </div>
            {% empty %}
                <p>Chưa có bình luận nào.</p>
            {% endfor %}
        </div>
    </div>

<!-- templates/post/admin_post_detail.html (PHẦN TIẾP THEO) -->

    <!-- CỘT THÔNG TIN VÀ HÀNH ĐỘNG (SIDEBAR) -->
    <div class="sidebar-column">
        <div class="card">
            <h3 class="section-title">Thông tin</h3>
            <ul class="info-list">
                <li>
                    <span class="label">Trạng thái</span>
                    <span class="value">
                        {% if post.trang_thai == 'cho_duyet' %}<span class="badge badge-pending">Chờ duyệt</span>
                        {% elif post.trang_thai == 'da_duyet' %}<span class="badge badge-approved">Đã duyệt</span>
                        {% elif post.trang_thai == 'tu_choi' %}<span class="badge badge-rejected">Từ chối</span>
                        {% endif %}
                    </span>
                </li>
                <li>
                    <span class="label">Tác giả</span>
                    <span class="value">@{{ post.tac_gia.username }}</span>
                </li>
                <li>
                    <span class="label">Ngày đăng</span>
                    <span class="value">{{ post.ngay_dang|date:"d/m/Y" }}</span>
                </li>
                <li>
                    <span class="label">Bình chọn</span>
                    <span class="value">{{ post.luot_binh_chon }}</span>
                </li>
                <li>
                    <span class="label">Bình luận</span>
                    <span class="value">{{ post.binh_luan.count }}</span>
                </li>
                 {% if post.chuyen_di %}
                <li>
                    <span class="label">Chuyến đi</span>
                    <span class="value">{{ post.chuyen_di.ten_chuyen_di }}</span>
                </li>
                {% endif %}
            </ul>
        </div>

        {% if post.tags.all %}
        <div class="card">
            <h3 class="section-title">Thẻ (Tags)</h3>
            <div class="tag-list">
                {% for tag in post.tags.all %}
                    <span class="tag">{{ tag.ten }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="card">
            <h3 class="section-title">Hành động</h3>
            <div class="action-buttons">
                <!-- Nút Duyệt/Từ chối chỉ hiện khi bài đang chờ duyệt -->
                {% if post.trang_thai == 'cho_duyet' %}
                    <form method="POST" action="{% url 'post_admin:post_update_status' post.id 'da_duyet' %}" onsubmit="return confirm('Bạn chắc chắn muốn DUYỆT bài viết này?');">
                        {% csrf_token %}
                        <button type="submit" class="action-btn btn-approve">Duyệt bài viết</button>
                    </form>
                    <form method="POST" action="{% url 'post_admin:post_update_status' post.id 'tu_choi' %}" onsubmit="return confirm('Bạn chắc chắn muốn TỪ CHỐI bài viết này?');">
                        {% csrf_token %}
                        <button type="submit" class="action-btn btn-reject">Từ chối bài viết</button>
                    </form>
                {% endif %}
                
                <!-- Nút Xóa -->
                <form method="POST" action="{% url 'post_admin:post_delete' post.id %}" onsubmit="return confirm('Hành động này không thể hoàn tác! Bạn có chắc chắn muốn XÓA bài viết này?');">
                    {% csrf_token %}
                    <button type="submit" class="action-btn btn-delete">Xóa vĩnh viễn</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock content %}