{% extends "admin_base.html" %}

{% block title %}Quản lý & Duyệt Bài Viết{% endblock %}

{% block content %}
<div class="container">
    <div class="admin-header">
        <div>
            <h1>Quản lý & Duyệt Bài Viết</h1>
            <p class="text-muted">Duyệt bài từ người dùng hoặc quản lý các bài viết hướng dẫn</p>
        </div>
        <a href="{% url 'articles:admin-create' %}" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 18px; height: 18px;">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            Tạo bài mới
        </a>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags|default:'info' }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Thêm filter bar và search functionality -->
    <div class="card" style="margin-bottom: var(--spacing-lg);">
        <div class="card-body" style="display: flex; gap: var(--spacing-md); flex-wrap: wrap; align-items: center;">
            <input type="text" placeholder="Tìm kiếm tiêu đề..." style="flex: 1; min-width: 200px;" class="form-control">
            <select style="width: 200px;" class="form-control">
                <option>Tất cả trạng thái</option>
                <option>Chờ duyệt</option>
                <option>Đã duyệt</option>
            </select>
        </div>
    </div>

    <div class="card">
        <div class="card-body" style="overflow-x: auto;">
            {% if articles %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Tiêu đề</th>
                        <th>Chuyên mục</th>
                        <th>Tác giả</th>
                        <th>Ngày gửi</th>
                        <th style="text-align: center;">Trạng thái</th>
                        <th style="text-align: center; width: 280px;">Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    {% for article in articles %}
                    <tr>
                        <td><strong>{{ article.tieu_de|truncatewords:8 }}</strong></td>
                        <td>
                            <span class="badge badge-info">{{ article.chuyen_muc.ten|default:"-" }}</span>
                        </td>
                        <td>{{ article.tac_gia.username|default:"Không xác định" }}</td>
                        <td>{{ article.ngay_dang|date:"d/m/Y, H:i" }}</td>
                        <td style="text-align: center;">
                            {% if article.da_duyet %}
                                <span class="badge badge-success">✓ Đã duyệt</span>
                            {% else %}
                                <span class="badge badge-warning">⏳ Chờ duyệt</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            {% if not article.da_duyet %}
                            <form action="{% url 'articles:admin-approve' article.pk %}" method="post" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm" style="background-color: var(--success); color: white;">Duyệt</button>
                            </form>
                            {% endif %}
                            <a href="{% url 'articles:admin-update' article.pk %}" class="btn btn-sm btn-outline">Sửa</a>
                            <a href="{% url 'articles:admin-delete' article.pk %}" class="btn btn-sm btn-danger">Xóa</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="text-center" style="padding: var(--spacing-xl);">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 48px; height: 48px; margin: 0 auto var(--spacing-lg); color: var(--gray-300);">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                </svg>
                <h3 style="color: var(--gray-500); margin-bottom: var(--spacing-md);">Không có bài viết</h3>
                <p style="color: var(--gray-500); margin-bottom: var(--spacing-lg);">Hiện chưa có bài viết nào cần duyệt hoặc quản lý.</p>
                <a href="{% url 'articles:admin-create' %}" class="btn btn-primary">Tạo bài viết đầu tiên</a>
            </div>
            {% endif %}
        </div>

        {% if is_paginated %}
        <div class="card-footer d-flex justify-center">
            <nav class="pagination">
                {% if page_obj.has_previous %}<a href="?page={{ page_obj.previous_page_number }}" class="pagination-item">← Trước</a>{% else %}<span class="pagination-item disabled">← Trước</span>{% endif %}
                <span style="padding: 0 var(--spacing-md); color: var(--gray-500); font-weight: 500;">Trang {{ page_obj.number }}/{{ page_obj.paginator.num_pages }}</span>
                {% if page_obj.has_next %}<a href="?page={{ page_obj.next_page_number }}" class="pagination-item">Sau →</a>{% else %}<span class="pagination-item disabled">Sau →</span>{% endif %}
            </nav>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
