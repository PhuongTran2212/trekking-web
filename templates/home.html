{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Trang Chủ - TrekViet - Khám Phá Việt Nam{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<style>
    :root {
        --primary-green: #2d5016;
        --accent-green: #10b981; /* Updated to Emerald */
        --light-green: #ecfdf5; /* Updated to match Emerald */
        --text-dark: #1f2937;
    }

    /* Override Bootstrap colors for consistency */
    .text-success { color: var(--accent-green) !important; }
    .bg-success { background-color: var(--accent-green) !important; }
    .btn-success { background-color: var(--accent-green); border-color: var(--accent-green); }
    .btn-success:hover { background-color: #059669; border-color: #059669; }
    .btn-outline-success { color: var(--accent-green); border-color: var(--accent-green); }
    .btn-outline-success:hover { background-color: var(--accent-green); color: white; }

    /* Hero Section */
    .hero-section {
        position: relative;
        min-height: 85vh;
        background: linear-gradient(135deg, rgba(45, 80, 22, 0.85), rgba(16, 185, 129, 0.8)),
                    url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=1920') center/cover;
        color: white;
        display: flex;
        align-items: center;
        text-align: center;
    }

    .hero-title {
        font-size: 3.5rem;
        font-weight: 800;
        text-shadow: 2px 4px 8px rgba(0,0,0,0.3);
        margin-bottom: 1.5rem;
    }

    .hero-highlight {
        color: #fbbf24; /* Amber-400 */
    }

    .search-box {
        max-width: 700px;
        margin: 2rem auto;
    }

    .search-box .input-group {
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        border-radius: 50px;
        overflow: hidden;
        background: white;
        padding: 5px;
    }

    .search-box input {
        border: none;
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
        box-shadow: none !important;
    }

    .search-box .btn {
        padding: 0.8rem 2.5rem;
        font-weight: 600;
        border-radius: 50px;
        margin: 3px;
    }

    .btn-hero {
        padding: 1rem 2.5rem;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 50px;
        transition: all 0.3s;
    }

    .btn-hero:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    /* Section Styling */
    .section-title {
        font-size: 2.2rem;
        font-weight: 800;
        color: var(--primary-green);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
    }

    .section-title i {
        color: var(--accent-green);
        margin-right: 0.75rem;
        background: var(--light-green);
        padding: 10px;
        border-radius: 12px;
        font-size: 1.5rem;
    }

    /* Trek Card */
    .trek-card {
        border: none;
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.3s;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }

    .trek-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }

    .trek-card img {
        height: 220px;
        object-fit: cover;
        transition: transform 0.5s;
    }

    .trek-card:hover img {
        transform: scale(1.05);
    }

    .badge-difficulty {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-weight: 600;
        backdrop-filter: blur(5px);
    }

    /* Trip Card */
    .trip-card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        transition: all 0.3s;
    }

    .trip-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    }

    .trip-card img {
        height: 200px;
        object-fit: cover;
    }

    .badge-price {
        position: absolute;
        bottom: 15px;
        right: 15px;
        background: white;
        color: var(--primary-green);
        padding: 0.6rem 1.2rem;
        border-radius: 25px;
        font-weight: 700;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .badge-slots {
        position: absolute;
        top: 15px;
        left: 15px;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .badge-slots.urgent {
        background: #dc3545;
        color: white;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    /* Community Card */
    .community-card {
        border: none;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        transition: all 0.3s;
        background: white;
    }

    .community-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .author-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        object-fit: cover;
    }

    .knowledge-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    /* Knowledge Card */
    .knowledge-card {
        border: none;
        border-radius: 16px;
        transition: all 0.3s;
        background: white;
        height: 100%;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        overflow: hidden;
    }

    .knowledge-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }

    .knowledge-card .card-body {
        padding: 1.5rem;
    }

    .knowledge-badge {
        background-color: var(--light-green);
        color: var(--accent-green);
        font-weight: 600;
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.85rem;
        display: inline-block;
        margin-bottom: 1rem;
    }

    /* Animations */
    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
    }

    .animate-float {
        animation: float 3s ease-in-out infinite;
    }

    .fade-in-up {
        animation: fadeInUp 0.8s ease-out;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .hero-title {
            font-size: 2.2rem;
        }
        .section-title {
            font-size: 1.8rem;
        }
    }
</style>
{% endblock %}

{% block content %}

<!-- Hero Section -->
<section class="hero-section">
    <div class="container position-relative z-1">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <h1 class="hero-title animate__animated animate__fadeInDown">
                    Khám Phá Vẻ Đẹp <span class="hero-highlight">Việt Nam</span>
                </h1>
                <p class="lead mb-5 fs-4 animate__animated animate__fadeInUp animate__delay-1s">
                    Kết nối đam mê, chinh phục những cung đường trekking tuyệt đẹp
                </p>

                <div class="search-box animate__animated animate__fadeInUp animate__delay-1s">
                    <form action="{% url 'treks:cung_duong_list' %}" method="get">
                        <div class="input-group">
                            <span class="input-group-text bg-transparent border-0 ps-4">
                                <i class="fas fa-search text-muted"></i>
                            </span>
                            <input type="text" name="q" class="form-control" placeholder="Tìm cung đường, địa điểm bạn muốn đến...">
                            <button class="btn btn-success" type="submit">Khám phá ngay</button>
                        </div>
                    </form>
                </div>

                <div class="mt-5 d-flex justify-content-center gap-3 animate__animated animate__fadeInUp animate__delay-2s">
                    <a href="{% url 'treks:cung_duong_list' %}" class="btn btn-hero btn-light text-success">
                        <i class="fas fa-map-marked-alt me-2"></i>Cung đường
                    </a>
                    <a href="{% url 'trips:trip_hub' %}" class="btn btn-hero btn-outline-light">
                        <i class="fas fa-users me-2"></i>Tìm bạn đồng hành
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Treks Section -->
<section class="py-5 bg-light" id="featured">
    <div class="container">
        <div class="d-flex justify-content-between align-items-end mb-5">
            <div>
                <h2 class="section-title"><i class="fas fa-mountain"></i> Cung đường nổi bật</h2>
                <p class="text-muted mb-0 fs-5 ms-1">Những địa điểm trekking được yêu thích nhất</p>
            </div>
            <a href="{% url 'treks:cung_duong_list' %}" class="btn btn-outline-success rounded-pill px-4">
                Xem tất cả <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>

        <div class="row g-4">
            {% for trek in featured_treks %}
            <div class="col-md-6 col-lg-3 fade-in-up">
                <a href="{% url 'treks:cung_duong_detail' slug=trek.slug %}" class="text-decoration-none text-dark">
                    <div class="card trek-card h-100">
                        <div class="position-relative overflow-hidden">
                            <img src="{{ trek.anh_bia_url }}" class="card-img-top" alt="{{ trek.ten }}">
                            <div class="position-absolute top-0 end-0 m-2">
                                <span class="badge bg-warning text-dark rounded-pill shadow-sm">
                                    <i class="fas fa-star me-1"></i>{{ trek.danh_gia_trung_binh|floatformat:1 }}
                                </span>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title fw-bold mb-2 text-truncate">{{ trek.ten }}</h5>
                            <p class="text-muted mb-3 small"><i class="fas fa-map-marker-alt text-success me-1"></i> {{ trek.tinh_thanh.ten }}</p>
                            
                            <div class="d-flex justify-content-between text-center bg-light rounded-3 p-2">
                                <div><strong class="text-success d-block">{{ trek.do_dai_km|floatformat:1 }}</strong><small class="text-muted" style="font-size: 0.75rem">km</small></div>
                                <div class="border-start border-end px-2">
                                    <strong class="text-success d-block">{{ trek.thoi_gian_uoc_tinh_gio|default:"--" }}</strong>
                                    <small class="text-muted" style="font-size: 0.75rem">giờ</small>
                                </div>
                                <div><strong class="text-success d-block">{{ trek.tong_do_cao_leo_m|default:"--" }}</strong><small class="text-muted" style="font-size: 0.75rem">m leo</small></div>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5"><p class="text-muted">Chưa có dữ liệu.</p></div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Upcoming Trips Section -->
<section class="py-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-end mb-5">
            <div>
                <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Chuyến đi sắp tới</h2>
                <p class="text-muted mb-0 fs-5 ms-1">Đừng bỏ lỡ cơ hội tham gia cùng đồng đội</p>
            </div>
            <a href="{% url 'trips:trip_hub' %}" class="btn btn-outline-success rounded-pill px-4">
                Đến Trip Hub <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>

        <div class="row g-4">
            {% for trip in upcoming_trips %}
            <div class="col-md-6 col-lg-4 fade-in-up">
                {% include "trips/partials/trip_card.html" with trip=trip %}
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <div class="text-muted">
                    <i class="far fa-calendar-times fa-3x mb-3"></i>
                    <p class="fs-5">Chưa có chuyến đi nào sắp tới.</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Community & Knowledge Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row g-5">
            <!-- Community Posts -->
            <div class="col-lg-7">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title mb-0"><i class="fas fa-users"></i> Góc Cộng đồng</h2>
                    <a href="{% url 'community:danh-sach-bai-viet' %}" class="btn btn-link text-success text-decoration-none fw-bold">
                        Xem thêm <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>

                <div class="d-flex flex-column gap-4">
                    {% for post in community_posts %}
                    <div class="card community-card fade-in-up p-4">
                        <div class="d-flex align-items-center mb-3">
                            {% if post.tac_gia.taikhoanhoso.anh_dai_dien %}
                                <img src="{{ post.tac_gia.taikhoanhoso.anh_dai_dien.url }}" class="author-avatar me-3 shadow-sm" alt="Avatar">
                            {% else %}
                                <div class="author-avatar bg-success text-white d-flex align-items-center justify-content-center me-3 fw-bold shadow-sm fs-5">
                                    {{ post.tac_gia.username|slice:":1"|upper }}
                                </div>
                            {% endif %}
                            <div>
                                <h6 class="mb-0 fw-bold text-dark">{{ post.tac_gia.get_full_name|default:post.tac_gia.username }}</h6>
                                <small class="text-muted">{{ post.ngay_dang|date:"d/m/Y" }}</small>
                            </div>
                        </div>

                        <h4 class="fw-bold mb-2">
                            <a href="{% url 'community:chi-tiet-bai-viet' bai_viet_id=post.pk %}" class="text-dark text-decoration-none hover-text-success transition-all">
                                {{ post.tieu_de }}
                            </a>
                        </h4>
                        <p class="text-muted mb-3">{{ post.noi_dung|safe|striptags|truncatewords:30 }}</p>

                        <div class="d-flex justify-content-between align-items-center mt-2 pt-3 border-top border-light">
                            <div class="d-flex gap-3 text-muted">
                                <span><i class="far fa-thumbs-up me-1"></i> {{ post.luot_binh_chon }}</span>
                                <span><i class="far fa-comment me-1"></i> {{ post.so_luong_binh_luan }}</span>
                            </div>
                            <a href="{% url 'community:chi-tiet-bai-viet' bai_viet_id=post.pk %}" class="btn btn-sm btn-light text-success rounded-pill px-3 fw-bold">
                                Đọc tiếp
                            </a>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-4 text-muted">Chưa có bài viết nào.</div>
                    {% endfor %}
                </div>
            </div>

            <!-- Knowledge Hub -->
            <div class="col-lg-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title mb-0"><i class="fas fa-book-open"></i> Kiến thức</h2>
                    <a href="{% url 'knowledge:list' %}" class="btn btn-link text-success text-decoration-none fw-bold">
                        Tất cả <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>

                <div class="row g-3">
                    {% for article in knowledge_articles %}
                    <div class="col-12 fade-in-up">
                        <a href="{% url 'knowledge:detail' pk=article.pk %}" class="text-decoration-none text-dark">
                            <div class="card knowledge-card h-100">
                                <div class="card-body d-flex flex-column">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <span class="knowledge-badge">
                                            {{ article.chuyen_muc }}
                                        </span>
                                        <small class="text-muted">{{ article.ngay_dang|date:"d/m" }}</small>
                                    </div>
                                    <h5 class="fw-bold mb-2 lh-base">{{ article.tieu_de }}</h5>
                                    <p class="text-muted small mb-0 flex-grow-1">{{ article.noi_dung|striptags|truncatewords:15 }}</p>
                                    
                                    <div class="d-flex align-items-center mt-3 pt-3 border-top border-light">
                                        <div class="d-flex align-items-center">
                                            <div class="rounded-circle bg-light text-success d-flex align-items-center justify-content-center fw-bold me-2" style="width: 24px; height: 24px; font-size: 0.7rem;">
                                                {{ article.tac_gia.username|slice:":1"|upper }}
                                            </div>
                                            <small class="text-muted" style="font-size: 0.8rem">{{ article.tac_gia.get_full_name|default:article.tac_gia.username }}</small>
                                        </div>
                                        <i class="fas fa-arrow-right text-success ms-auto"></i>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% empty %}
                    <div class="col-12 text-center py-5 border rounded-3 bg-white">
                        <i class="fas fa-book-reader fa-3x text-muted mb-3 opacity-50"></i>
                        <p class="text-muted mb-0">Đang cập nhật kiến thức...</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
// Smooth scroll
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
});

// Animation Observer
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
        }
    });
}, { threshold: 0.1 });

document.querySelectorAll('.fade-in-up').forEach(el => {
    el.style.opacity = '0';
    el.style.transform = 'translateY(30px)';
    el.style.transition = 'all 0.6s ease-out';
    observer.observe(el);
});
</script>
{% endblock %}