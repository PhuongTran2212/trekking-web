{% extends 'base.html' %}
{% load static %}

{% block title %}{{ trek.ten }} - Chi tiết Cung đường{% endblock %}

{% block extra_css %}
<!-- Thư viện Leaflet cho bản đồ -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<!-- Thư viện LightGallery cho popup ảnh -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.2/css/lightgallery.min.css" />
<style>
    :root {
        --spacing-xs: 0.5rem;
        --spacing-sm: 0.75rem;
        --spacing-md: 1rem;
        --spacing-lg: 1.5rem;
        --spacing-xl: 2rem;
        --spacing-2xl: 3rem;
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --primary-dark: #1eaf5f;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-300: #d1d5db;
        --gray-600: #4b5563;
        --gray-900: #111827;
        --warning: #f59e0b;
    }
    
    body {
        font-family: sans-serif;
    }

    .container {
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        padding-left: 15px;
        padding-right: 15px;
    }
    .my-5 {
        margin-top: 3rem;
        margin-bottom: 3rem;
    }

    /* === BỐ CỤC CHÍNH (FLEXBOX) === */
    .row {
        display: flex;
        flex-wrap: wrap; 
        gap: var(--spacing-xl); 
    }
    .col-lg-8 {
        flex: 1; 
        min-width: 60%; 
    }
    .col-lg-4 {
        width: 350px; 
        flex-shrink: 0; 
    }
    @media (max-width: 991.98px) {
        .col-lg-8,
        .col-lg-4 {
            width: 100%; 
        }
    }
    
    /* === THỐNG KÊ ĐÁNH GIÁ === */
    .rating-summary {
        display: flex;
        gap: var(--spacing-xl);
        align-items: center;
        margin-bottom: var(--spacing-xl);
        padding: var(--spacing-lg);
        background-color: var(--gray-50);
        border-radius: var(--radius-lg);
    }
    .rating-summary-overview {
        text-align: center;
        flex-shrink: 0;
        width: 150px;
    }
    .rating-summary-overview .average-score {
        font-size: 3.5rem;
        font-weight: 800;
        color: var(--gray-900);
        line-height: 1;
    }
    .rating-summary-overview .average-stars .fa-star {
        color: var(--warning);
    }
    .rating-summary-overview .total-reviews {
        font-size: 0.9rem;
        color: var(--gray-600);
        margin-top: var(--spacing-sm);
    }
    .rating-summary-breakdown {
        flex-grow: 1;
    }
    .rating-bar-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-xs);
        font-size: 0.9rem;
    }
    .rating-bar-item .star-label {
        color: var(--gray-600);
        width: 50px;
        flex-shrink: 0;
    }
    .progress-bar-container {
        flex-grow: 1;
        height: 8px;
        background-color: var(--gray-100);
        border-radius: 4px;
        overflow: hidden;
    }
    .progress-bar-fill {
        height: 100%;
        background-color: var(--warning);
        border-radius: 4px;
        transition: width 0.5s ease-in-out;
    }
    .rating-bar-item .count {
        color: var(--gray-900);
        font-weight: 600;
        min-width: 30px;
        text-align: right;
    }

    /* === Cover Image & Header === */
    .trek-cover-container {
        height: 500px;
        position: relative;
        border-radius: var(--radius-xl);
        overflow: hidden;
        margin-bottom: var(--spacing-2xl);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .trek-cover-image {
        width: 100%;
        height: 100%;
        background-image: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0) 100%), url('{{ trek.anh_bia_url }}');
        background-size: cover;
        background-position: center;
        transition: transform 0.3s ease;
    }
    .trek-cover-container:hover .trek-cover-image {
        transform: scale(1.02);
    }
    .trek-header-content {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: var(--spacing-2xl);
        color: white;
    }
    .trek-location {
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        margin-bottom: var(--spacing-sm);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        padding: 0.5rem 1rem;
        border-radius: 2rem;
    }
    .trek-title {
        font-size: 3.5rem;
        font-weight: 800;
        line-height: 1.1;
        text-shadow: 0 4px 20px rgba(0,0,0,0.6);
        margin: 0;
        color: white; /* ĐẢM BẢO MÀU TRẮNG CHO TÊN CUNG ĐƯỜNG */
    }

    /* === Các style khác (giữ nguyên) === */
    .stats-bar { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); background: linear-gradient(135deg, #ffffff 0%, var(--gray-50) 100%); padding: var(--spacing-xl); border-radius: var(--radius-xl); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); margin-bottom: var(--spacing-xl); border: 1px solid rgba(0, 0, 0, 0.05); } @media (min-width: 768px) { .stats-bar { grid-template-columns: repeat(4, 1fr); gap: var(--spacing-lg); } } .stat-item { text-align: center; padding: var(--spacing-md); border-radius: var(--radius-lg); transition: all 0.3s ease; position: relative; } .stat-item:hover { background: white; transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); } .stat-item i { font-size: 2rem; color: var(--primary-dark); margin-bottom: var(--spacing-md); display: block; } .stat-value { font-size: 1.75rem; font-weight: 800; color: var(--gray-900); margin-bottom: var(--spacing-xs); line-height: 1; } .stat-label { font-size: 0.875rem; color: var(--gray-600); font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em; }
    .card { border: none; border-radius: var(--radius-xl); box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); margin-bottom: var(--spacing-xl); overflow: hidden; transition: box-shadow 0.3s ease; } .card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); } .card-header { background: linear-gradient(135deg, var(--gray-50) 0%, white 100%); border-bottom: 2px solid var(--gray-100); padding: var(--spacing-lg) var(--spacing-xl); font-weight: 700; } .card-header h5 { margin: 0; font-size: 1.25rem; color: var(--gray-900); } .card-body { padding: var(--spacing-xl); } .card-title { font-size: 1.5rem; font-weight: 700; color: var(--gray-900); margin-bottom: var(--spacing-lg); display: flex; align-items: center; gap: var(--spacing-md); } .card-title::before { content: ''; width: 4px; height: 1.5rem; background: var(--primary-dark); border-radius: 2px; }
    #trek-map { height: 500px; border-radius: var(--radius-lg); box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06); }
    .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: var(--spacing-md); } .gallery-grid a { position: relative; overflow: hidden; border-radius: var(--radius-lg); display: block; aspect-ratio: 1; } .gallery-grid a::after { content: ''; position: absolute; inset: 0; background: rgba(0, 0, 0, 0); transition: background 0.3s ease; } .gallery-grid a:hover::after { background: rgba(0, 0, 0, 0.3); } .gallery-grid img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease; } .gallery-grid a:hover img { transform: scale(1.1); }
    .review-list { margin-top: var(--spacing-xl); } .review-item { padding: var(--spacing-lg); background: var(--gray-50); border-radius: var(--radius-lg); margin-bottom: var(--spacing-lg); transition: all 0.3s ease; } .review-item:hover { background: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); } .rating-stars { display: inline-flex; gap: 0.25rem; } .rating-stars .fa-star { font-size: 1rem; color: var(--warning); } .rating-stars .fa-star.text-muted { color: var(--gray-300) !important; } .review-images { display: flex; flex-wrap: wrap; gap: var(--spacing-sm); margin-top: var(--spacing-md); } .review-images a { border-radius: var(--radius-md); overflow: hidden; display: block; transition: transform 0.2s ease; } .review-images a:hover { transform: scale(1.05); }
    .sidebar-card { position: sticky; top: 20px; } .sidebar-card .card { margin-bottom: var(--spacing-lg); } .list-group-item { border: none; padding: var(--spacing-md) 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--gray-100); } .list-group-item:last-child { border-bottom: none; }
    .btn { border-radius: var(--radius-lg); font-weight: 600; padding: 0.75rem 1.5rem; transition: all 0.3s ease; border: none; cursor: pointer; } .btn-primary { background: linear-gradient(135deg, var(--primary-dark) 0%, #2563eb 100%); color: white; box-shadow: 0 4px 6px -1px rgba(30, 64, 175, 0.3); } .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(30, 64, 175, 0.4); } .btn-secondary { background: var(--gray-100); color: var(--gray-900); } .btn-secondary:hover { background: var(--gray-300); transform: translateY(-2px); } .btn-icon { width: 40px; height: 40px; padding: 0; display: inline-flex; align-items: center; justify-content: center; margin: 0 0.25rem; } .btn-light { background: var(--gray-100); color: var(--gray-600); } .btn-light:hover { background: var(--primary-dark); color: white; }
    .equipment-checklist { list-style: none; padding: 0; margin: 0; } .equipment-item { display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md); border-radius: var(--radius-md); transition: background 0.2s ease; } .equipment-item:hover { background: var(--gray-50); } .equipment-checkbox { width: 20px; height: 20px; cursor: pointer; } .equipment-name { font-size: 0.95rem; color: var(--gray-900); }
    .creator-card { display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-lg); } .creator-avatar { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 3px solid var(--gray-100); } .creator-info { flex: 1; } .creator-name { font-weight: 700; color: var(--gray-900); text-decoration: none; font-size: 1.1rem; } .creator-name:hover { color: var(--primary-dark); }
    @media (max-width: 768px) { .trek-title { font-size: 2rem; } .trek-cover-container { height: 350px; } .trek-header-content { padding: var(--spacing-lg); } .card-body { padding: var(--spacing-lg); } .rating-summary { flex-direction: column; } }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    
    <!-- COVER IMAGE & HEADER -->
    <div class="trek-cover-container">
        <div class="trek-cover-image"></div>
        <div class="trek-header-content">
            <div class="trek-location">
                <i class="fas fa-map-marker-alt"></i>
                {{ trek.tinh_thanh.ten }}
            </div>
            <h1 class="trek-title">{{ trek.ten }}</h1>
        </div>
    </div>

    <div class="row">
        <!-- CỘT NỘI DUNG CHÍNH (TRÁI) -->
        <main class="col-lg-8">

            <!-- STATS BAR - THANH THÔNG SỐ NHANH -->
            <div class="stats-bar">
                <div class="stat-item">
                    <i class="fas fa-route"></i>
                    <div class="stat-value">{{ trek.do_dai_km }}</div>
                    <div class="stat-label">Độ dài (km)</div>
                </div>
                <div class="stat-item">
                    <i class="far fa-clock"></i>
                    <div class="stat-value">{{ trek.thoi_gian_uoc_tinh_gio }}</div>
                    <div class="stat-label">Thời gian (giờ)</div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-mountain"></i>
                    <div class="stat-value">{{ trek.tong_do_cao_leo_m }}</div>
                    <div class="stat-label">Độ cao leo (m)</div>
                </div>
                <div class="stat-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <div class="stat-value">{{ trek.do_kho.ten }}</div>
                    <div class="stat-label">Độ khó</div>
                </div>
            </div>

            <!-- MÔ TẢ -->
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Giới thiệu hành trình</h4>
                    <p style="line-height: 1.7; color: var(--gray-600);">{{ trek.mo_ta|linebreaks }}</p>
                </div>
            </div>

            <!-- BẢN ĐỒ -->
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Bản đồ lộ trình</h4>
                    <div id="trek-map"></div>
                </div>
            </div>

            <!-- THƯ VIỆN HÌNH ẢNH -->
            {% if trek.gallery_media %}
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Thư viện media</h4>
                    <div class="gallery-grid" id="trek-gallery-container">
                        {% for media in trek.gallery_media %}
                            <a href="{{ media.file.url }}">
                                <img src="{{ media.file.url }}" alt="Hình ảnh {{ trek.ten }}" loading="lazy">
                            </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- ĐÁNH GIÁ -->
            <div class="card" id="reviews">
                <div class="card-body">
                    <h4 class="card-title">Đánh giá của cộng đồng ({{ total_reviews }} lượt)</h4>
                    
                    <!-- KHUNG THỐNG KÊ ĐÁNH GIÁ -->
                    {% if total_reviews > 0 %}
                    <div class="rating-summary">
                        <!-- Cột bên trái: Điểm trung bình -->
                        <div class="rating-summary-overview">
                            <div class="average-score">{{ average_rating|floatformat:1 }}</div>
                            <div class="average-stars">
                                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                            </div>
                            <div class="total-reviews">từ {{ total_reviews }} đánh giá</div>
                        </div>

                        <!-- Cột bên phải: Chi tiết từng sao -->
                        <div class="rating-summary-breakdown">
                            {% for item in rating_breakdown %}
                            <div class="rating-bar-item">
                                <span class="star-label">{{ item.stars }} sao</span>
                                <div class="progress-bar-container">
                                    <div class="progress-bar-fill" style                                </div>
                                <span class="count">{{ item.count }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- FORM ĐÁNH GIÁ -->
                    {% if user.is_authenticated %}
                        {% if not user_has_reviewed %}
                        <div class="mb-4 p-4" style="background: var(--gray-50); border-radius: var(--radius-lg);">
                            <h5 style="margin-bottom: var(--spacing-lg);">Viết đánh giá của bạn</h5>
                            <form method="post" enctype="multipart/form-data">
                                {% csrf_token %}
                                <!-- ... Form fields ... -->
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane me-2"></i>Gửi đánh giá
                                </button>
                            </form>
                        </div>
                        {% else %}
                        <div class="alert alert-info" style="border-radius: var(--radius-lg);">
                            <i class="fas fa-check-circle me-2"></i>Bạn đã đánh giá cung đường này.
                        </div>
                        {% endif %}
                    {% else %}
                    <div class="alert alert-warning" style="border-radius: var(--radius-lg);">
                        <i class="fas fa-sign-in-alt me-2"></i>
                        <a href="#">Đăng nhập</a> để gửi đánh giá.
                    </div>
                    {% endif %}
                    
                    <!-- DANH SÁCH ĐÁNH GIÁ -->
                    <div class="review-list">
                        {% for review in reviews %}
                        <div class="review-item" data-lightgallery-review>
                            <div style="display: flex; align-items: flex-start; gap: 1rem;">
                                <img src="{{ review.user.taikhoanhoso.avatar_url }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%; border: 2px solid var(--gray-100);">
                                <div style="flex-grow: 1;">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <div>
                                            <strong style="font-size: 1.1rem; color: var(--gray-900);">{{ review.user.username|default:"[Người dùng đã xóa]" }}</strong>
                                            <div class="rating-stars" style="display: inline-block; margin-left: 0.5rem;">
                                                {% for i in "12345"|make_list %}
                                                <i class="fas fa-star {% if i|add:0 > review.diem_danh_gia %}text-muted{% endif %}"></i>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        <small style="color: var(--gray-600);">{{ review.ngay_danh_gia|timesince }} trước</small>
                                    </div>
                                    <p style="margin: var(--spacing-md) 0; line-height: 1.6; color: var(--gray-600);">{{ review.binh_luan }}</p>
                                    {% if review.anh_danh_gia.all %}
                                    <div class="review-images">
                                        {% for anh in review.anh_danh_gia.all %}
                                        <a href="{{ anh.hinh_anh.url }}">
                                            <img src="{{ anh.hinh_anh.url }}" style="width: 100px; height: 100px; object-fit: cover; border-radius: var(--radius-md);" loading="lazy">
                                        </a>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div style="text-align: center; padding: 3rem 0;">
                            <i class="fas fa-comments" style="font-size: 3rem; color: var(--gray-300); margin-bottom: var(--spacing-md);"></i>
                            <p style="color: var(--gray-600);">Chưa có đánh giá nào. Hãy là người đầu tiên!</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </main>

        <!-- CỘT THÔNG TIN PHỤ (PHẢI) -->
        <aside class="col-lg-4">
            <div class="sidebar-card">
                <!-- CARD HÀNH ĐỘNG & CHIA SẺ -->
                <div class="card">
                    <div class="card-body">
                        <a href="#" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem; text-align: center; display: block; text-decoration: none;">
                            <i class="fas fa-search me-2"></i>Tìm chuyến đi
                        </a>
                        <a href="#" class="btn btn-secondary" style="width: 100%; margin-bottom: 1.5rem; text-align: center; display: block; text-decoration: none;">
                            <i class="fas fa-plus me-2"></i>Tạo chuyến đi mới
                        </a>
                        <div style="text-align: center; padding-top: 1rem; border-top: 1px solid var(--gray-100);">
                            <span style="color: var(--gray-600); margin-right: 0.5rem; font-size: 0.9rem; font-weight: 600;">Chia sẻ:</span>
                            <a href="#" class="btn btn-icon btn-light"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="btn btn-icon btn-light"><i class="fab fa-twitter"></i></a>
                            <a href="#" class="btn btn-icon btn-light"><i class="fas fa-link"></i></a>
                        </div>
                    </div>
                </div>
                
                <!-- CARD THÔNG TIN BỔ SUNG -->
                <div class="card">
                    <div class="card-header"><h5>Thông tin thêm</h5></div>
                    <div class="card-body">
                        <ul style="list-style: none; padding: 0; margin: calc(var(--spacing-lg) * -1);">
                            <li class="list-group-item" style="padding: var(--spacing-lg);">
                                <span style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                    <i class="fas fa-cloud-sun-rain" style="color: var(--primary-dark);"></i>
                                    <span style="color: var(--gray-600);">Mùa đẹp nhất</span>
                                </span>
                                <strong style="color: var(--gray-900);">{{ trek.mua_dep_nhat|default:"Chưa cập nhật" }}</strong>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- VẬT DỤNG GỢI Ý -->
                <div class="card">
                    <div class="card-header"><h5>Vật dụng gợi ý</h5></div>
                    <div class="card-body">
                        <ul class="equipment-checklist">
                            {% for item in vat_dung_goi_y %}
                                <li class="equipment-item">
                                    <input type="checkbox" class="equipment-checkbox" id="item-{{ forloop.counter }}">
                                    <label for="item-{{ forloop.counter }}" class="equipment-name">{{ item.vat_dung.ten }}</label>
                                </li>
                            {% empty %}
                                <li style="text-align: center; padding: 1rem 0; color: var(--gray-600);">Chưa có gợi ý vật dụng.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <!-- THÔNG TIN NGƯỜI TẠO -->
                {% if trek.nguoi_tao %}
                <div class="card">
                    <div class="card-header"><h5>Người tạo</h5></div>
                    <div class="card-body creator-card">
                        <img src="{{ trek.nguoi_tao.taikhoanhoso.avatar_url }}" class="creator-avatar" alt="{{ trek.nguoi_tao.username }}">
                        <div class="creator-info">
                            <a href="#" class="creator-name">{{ trek.nguoi_tao.get_full_name|default:trek.nguoi_tao.username }}</a>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </aside>
    </div>
</div>

{{ trek.du_lieu_ban_do_geojson|json_script:"map-data" }}
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.2/lightgallery.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- KHỞI TẠO BẢN ĐỒ ---
    const mapDataElement = document.getElementById('map-data');
    if (mapDataElement) {
        try {
            const geojsonData = JSON.parse(mapDataElement.textContent);
            if (!geojsonData?.features?.length) { throw new Error("Dữ liệu GeoJSON không hợp lệ."); }
            const map = L.map('trek-map');
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { 
                maxZoom: 19, 
                attribution: '&copy; OpenStreetMap' 
            }).addTo(map);
            const trekLayer = L.geoJSON(geojsonData, { 
                style: { 
                    color: "#EF4444", 
                    weight: 4, 
                    opacity: 0.8 
                } 
            }).addTo(map);
            map.fitBounds(trekLayer.getBounds().pad(0.1));
        } catch(e) {
            console.error("Lỗi bản đồ: ", e);
            document.getElementById('trek-map').innerHTML = '<p style="text-align: center; color: #6c757d; padding: 3rem;">Không có dữ liệu bản đồ để hiển thị.</p>';
        }
    }

    // --- KHỞI TẠO LIGHTGALLERY CHO THƯ VIỆN ẢNH CHÍNH ---
    const galleryContainer = document.getElementById('trek-gallery-container');
    if(galleryContainer) {
        lightGallery(galleryContainer, { 
            selector: 'a', 
            download: true,
            speed: 500,
            getCaptionFromTitleOrAlt: true
        });
    }

    // --- KHỞI TẠO LIGHTGALLERY CHO ẢNH ĐÁNH GIÁ CỦA NGƯỜI DÙNG ---
    document.querySelectorAll('[data-lightgallery-review]').forEach(reviewEl => {
        lightGallery(reviewEl, { 
            selector: 'a', 
            download: true,
            speed: 500
        });
    });
});
</script>
{% endblock %}